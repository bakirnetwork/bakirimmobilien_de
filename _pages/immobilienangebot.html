---
layout: default
exec_php: |
  <?php

  require('../assets/php/exposify.php');

  /**
  * Get the base URL.
  *
  * @return string
  */
  function getBasePath() {
    return strtok($_SERVER["REQUEST_URI"],'?');
  }

  /**
  * Get a sorted images array.
  *
  * @param  array  $property
  * @return array
  */
  function getSortedImages($property) {
    usort($property['images'], function($imageOne, $imageTwo) {
      $a = $imageOne['attributes']['order'];
      $b = $imageTwo['attributes']['order'];
      if ($a == $b) return 0;
      return ($a < $b) ? -1 : 1;
    });
    return $property['images'];
  }

  /**
  * Get a sorted fields array.
  *
  * @param  array  $property
  * @return array
  */
  function getSortedFields($property) {
    usort($property['fields'], function($fieldOne, $fieldTwo) {
      $a = $fieldOne['attributes']['order'];
      $b = $fieldTwo['attributes']['order'];
      if ($a == $b) return 0;
      return ($a < $b) ? -1 : 1;
    });
    return $property['fields'];
  }

  /**
  * Get all small fields.
  *
  * @param  array  $property
  * @return array
  */
  function getSmallFields($property, $groups = 1) {

    $fields = array_filter(getSortedFields($property), function($field) use (&$count) {
      return $field['attributes']['type'] !== 'long';
    });

    $count = count($fields); // how many fields are there? // 21

    if ($groups === 1) {
      return $fields;
    } else {
      $fields_per_group = ceil($count / $groups); // round up
      return array_chunk($fields, $fields_per_group);
    }
  }

  /**
  * Get all large fields.
  *
  * @param  array  $property
  * @return array
  */
  function getLargeFields($property) {
    $fields = array_filter(getSortedFields($property), function($field) {
      return $field['attributes']['type'] === 'long';
    });
    return $fields;
  }

  /**
  * Get a value to display from a field.
  *
  * @param  array  $field
  * @return string
  */
  function getFieldValue($field) {
    $value = $field['attributes']['value'];
    if ($field['attributes']['type'] === 'price') {
      $value = number_format($value, 2, ',', '.') . ' €';
    } else if ($field['attributes']['type'] === 'area') {
      $value = number_format($value, 2, ',', '.') . ' m²';
    } else if ($field['attributes']['type'] === 'radio') {
      $value = ($value == 1) ? 'Ja' : 'Nein';
    }
    return $value;
  }

  $exposify = new Exposify($immoapikey);
  $exposify->requestSingleProperty($_GET['slug']);

  if (empty($exposify->getError())) {
    $result = $exposify->getResult();
    $id = $result['id'];
    $property = $result['attributes'];
    $contact = $result['attributes']['contact'];
  } else {
    if ($exposify->getError()['title'] === 'Not found') http_response_code(404);
    else http_response_code(500);
  }

  ?>
title: <?php echo $property['title']; ?>
permalink: /immobilienangebote/angebot.php
canonical: /immobilienangebote/<?php echo $property['slug']; ?>
menu_link: /immobilienangebote/
---

<main>
	<header class="page-header">
		<div class="row">
			<div class="column" style="position: relative;">
				<h1><?php echo($property['title']); ?></h1>
				<button class="js-open-request-modal" style="float: right; margin-top: -25px;">Anfragen</button>
			</div>
		</div>
	</header>

	<div class="slider property-slider">
		<div class="row">
			<div class="column">
				<?php foreach(getSortedImages($property) as $image): ?>
					<img class="slider-img" src="<?php echo $image['links']['wide'] ?>" alt="<?php echo($property['title']); ?>">
				<?php endforeach; ?>
			</div>
		</div>

		<button class="slider-next js-slider-control js-slider-prev">‹</button>
		<button class="slider-prev js-slider-control js-slider-next">›</button>
	</div>

	<div class="page-content">

		<div class="row property-info-row">

			<div class="column">
				<h2>Details</h2>
			</div>

			<div class="medium-6 column">
				<?php foreach(getSmallFields($property, 2)[0] as $field): ?>
					<div class="property-info-line">
						<b><?php echo $field['attributes']['name'] ?>:</b>
						<?php echo getFieldValue($field) ?>
					</div>
				<?php endforeach; ?>
			</div>

			<div class="medium-6 column">
				<?php foreach(getSmallFields($property, 2)[1] as $field): ?>
					<div class="property-info-line">
						<b><?php echo $field['attributes']['name'] ?>:</b>
						<?php echo getFieldValue($field) ?><br>
					</div>
				<?php endforeach; ?>
			</div>

		</div>

		<?php foreach(getLargeFields($property) as $field): ?>
			<div class="row property-info-row">
				<div class="medium-4 column">
					<h2><?php echo $field['attributes']['name'] ?></h2>
				</div>
				<div class="medium-8 column">
					<p><?php echo $field['attributes']['value'] ?></p>
				</div>
			</div>
		<?php endforeach; ?>

	</div>
</main>


<div class="modal-container js-close-request-modal" id="request-modal-container">
	<form class="modal box request-modal ajax" action="https://app.exposify.de/track-property-request" method="post" data-success-status="requested">
		<h3 class="box__title">
			Wir melden uns bei Ihnen!
			<span class="exit js-close-request-modal">
				<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewbox="0 0 40 40" style="margin-top: -4px; margin-right: -4px;"><path stroke="#FFFFFF" d="M 10,10 L 30,30 M 30,10 L 10,30"></svg>
			</span>
		</h3>
		<div class="box__content">
			<p>Hinterlassen Sie uns Ihren Namen und Ihre Telefonnummer, damit wir Sie erreichen können, um alle Fragen zu klären.</p>
			<input name="property_id" type="hidden" value="<?php echo $id ?>">
			<input name="client_name" type="text" placeholder="Vor- und Nachname" required>
			<input name="client_phone" type="text" placeholder="Telefonnummer" required>
			<div class="status request-modal-action"><button type="submit">Rückrufbitte absenden</button></div>
		</div>

	</form>
</div>
