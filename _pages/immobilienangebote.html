---
layout: default
exec_php: |
  <?php

  require('../assets/php/exposify.php');

  /**
  * Get the current search query.
  *
  * @return string
  */
  function getSearchQuery()
  {
  	return isset($_GET['search']) ? $_GET['search'] : '';
  }

  /**
  * Get the URL without parameters.
  *
  * @return string
  */
  function getBasePath()
  {
  	return strtok($_SERVER["REQUEST_URI"], '?');
  }

  $exposify = new Exposify($immoapikey, 'https://app.exposify.de');
  $exposify->requestAllProperties(getSearchQuery());

  if (!empty($exposify->getError())) {
    http_response_code(500);
  }

  $search_query = getSearchQuery();
  $properties = $exposify->getResult()

  ?>
title: Immobilienangebote
permalink: /immobilienangebote/index.php
canonical: /immobilienangebote/
menu_link: /immobilienangebote/
---

<main>
	<header class="page-header page-header--center">
		<div class="row">
			<div class="column">
				<h1>Immobilienangebote</h1>
			</div>
		</div>
	</header>

	<div class="page-content">
		<div class="row">

			<form method="get">
				<div class="immobilienangebote__search small-12 medium-8 medium-centered column">
					<div class="input-bar">
						<input class="input-bar__input" name="search" type="text" value="<?php echo($search_query); ?>" placeholder="Nach Immobilien suchen...">
						<button class="input-bar__button" type="submit">Suchen</button>
					</div>
				</div>
			</form>

			<?php if (!$properties): ?>
				<div class="column" style="text-align: center;">
					Leider konnten keine Immobilien gefunden werden.
					<a class="search-exit <?php echo getSearchQuery() ? 'search-exit--visible' :'' ?>" href="<?php echo getBasePath() ?>">

					</a>
					← <span class="search-exit__text">Zurück zur Übersicht</span>
				</div>
			<?php endif; ?>

			<ul class="offers">
				<?php foreach ($properties as $property): ?>
					<li class="medium-6 column">
						<a class="box offers-property" href="<?php echo($property['attributes']['slug']); ?>">
							<img class="offers-property-img" src="<?php echo($property['attributes']['thumbnail']['links']['thumbnail']); ?>" alt="<?php echo($property['attributes']['title']); ?>">
							<h2 class="offers-property-title"><?php echo($property['attributes']['title']); ?></h2>
						</a>
					</li>
				<?php endforeach; ?>
			</ul>

		</div>
	</div>
</main>
